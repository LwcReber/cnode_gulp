"use strict";!function(t){var e=document.documentElement,o=e.clientWidth;o=o>640?640:o<320?320:o;var n=o/t*100;e.style.fontSize=n+"px"}(414),window.angular.module("myApp",["ngRoute","ngAnimate","infinite-scroll","myApp.start","myApp.msg","myApp.detail","myApp.filtes","dir.footer","dir.header","dir.goback","myApp.publish","myApp.user"]).controller("parentCtrl",["$scope","$location",function(t,e){t.showTDetail=function(t){e.path("/detail").search({topicID:t})}}]).config(["$routeProvider",function(t){t.otherwise("/home")}]).run(["$http",function(t){t.defaults.headers.post={"Content-Type":"application/json; charset=utf-8"}}]),window.angular.module("myApp.detail",["ngRoute","ngAnimate"]).config(["$routeProvider",function(t){t.when("/detail",{templateUrl:"tpl/detail.html",controller:"detailCtrl"})}]).controller("detailCtrl",["$scope","$http","$location",function(t,e,o){t.html="",localStorage.accesstoken?(t.collStu={content:""},t.regStatus=!0,t.acctknUrl="&accesstoken="+localStorage.getItem("accesstoken")):(t.regStatus=!1,t.acctknUrl="");var n=o.search().topicID;n?e.get("https://cnodejs.org/api/v1/topic/"+n+"?mdrender=true"+t.acctknUrl).then(function(e){t.regStatus&&(t.collStu.status=e.data.data.is_collect,console.log(t.collStu.status),1==t.collStu.status?t.collStu.content="取消收藏":t.collStu.content="收藏"),t.html=e.data.data.content},function(t){console.log(t)}):window.history.go(-1),t.coll=function(){0==t.collStu.status?e.post("https://cnodejs.org/api/v1/topic_collect/collect",{accesstoken:localStorage.getItem("accesstoken"),topic_id:n}).then(function(e){t.collStu.status=!0,t.collStu.content="取消收藏"},function(t){console.log(t)}):e.post("https://cnodejs.org/api/v1/topic_collect/de_collect",{accesstoken:localStorage.getItem("accesstoken"),topic_id:n}).then(function(e){t.collStu.status=!1,t.collStu.content="收藏"},function(t){console.log(t)})}}]),window.angular.module("myApp.filtes",["ngRoute","ngAnimate"]).filter("to_trusted",["$sce",function(t){return function(e){return t.trustAsHtml(e)}}]),window.angular.module("dir.footer",["ngRoute","ngAnimate"]).directive("ngFooter",["$location",function(t){return{restrict:"AE",replace:!0,scope:{},templateUrl:"./tpl/footer.html",controller:["$scope",function(e){e.path=t.path(),e.navs=[{tab:"home",path:"/home"},{tab:"msg",path:"/msg"},{tab:"publish",path:"/publish"},{tab:"user",path:"/user"}],e.changeTab=function(e){t.path(e.path)}}]}}]),window.angular.module("dir.goback",["ngRoute","ngAnimate"]).directive("ngGoBack",[function(){return{restrict:"AE",scope:{},replace:!0,template:'<div class="go-back" ng-click="goBack()">返回</div>',controller:["$scope","$element","$attrs","$transclude",function(t,e,o,n){t.goBack=function(){window.history.go(-1)}}]}}]),window.angular.module("dir.header",["ngRoute","ngAnimate"]).directive("ngHeader",["$location",function(t){return{restrict:"E",scope:{},replace:!0,templateUrl:"./tpl/header.html",controller:["$scope",function(e){e.title="header",e.path=t.path()}]}}]),window.angular.module("myApp.start",["ngRoute","ngAnimate"]).config(["$routeProvider",function(t){t.when("/home",{templateUrl:"tpl/home.html",controller:"homeCtrl"})}]).controller("homeCtrl",["$scope","$http","$timeout","$location",function(t,e,o,n){t.scroll=!1,t.hasMore=!0,t.topicList=[],t.getDatas=function(o){t.scroll=!0,e.get("https://cnodejs.org/api/v1/topics?page=1&tab="+o+"&limit=20",{timeout:3e3}).then(function(e){-1!=Object.prototype.toString.call(e).indexOf("Object")?(e.data.data.lenth<20?t.hasMore=!1:t.scroll=!1,t.topicList=t.topicList.concat(e.data.data)):console.log("后台发送的topicList数据类型错误")},function(t){})},t.tabs=[{tab:"",name:"全部",active:!0},{tab:"good",name:"精华",active:!1},{tab:"share",name:"分享",active:!1},{tab:"ask",name:"问答",active:!1},{tab:"job",name:"招聘",active:!1}],t.changeTopic=function(e){for(var o=0;o<t.tabs.length;o++)t.tabs[o]!=e&&(t.tabs[o].active=!1);e.active=!0,t.topicList=[],t.getDatas(e.tab)}}]),window.angular.module("myApp.msg",["ngRoute","ngAnimate"]).config(["$routeProvider",function(t){t.when("/msg",{templateUrl:"tpl/msg.html",controller:"msgCtrl"})}]).controller("msgCtrl",["$scope","$http","$timeout",function(t,e,o){t.oldMsg="无消息",t.newMsg="无消息",t.msg=!1,void 0!=localStorage.getItem("accesstoken")&&e.get("https://cnodejs.org/api/v1/messages?&accesstoken="+localStorage.getItem("accesstoken")+"&mdrender=true").then(function(e){0==e.data.data.hasnot_read_messages.length?t.msg=!1:(t.msg=!0,t.newMsg=e.data.data.hasnot_read_messages),0==e.data.data.has_read_messages.length&&(t.oldMsg="无消息")},function(t){console.log(t)})}]),window.angular.module("myApp.publish",["ngRoute","ngAnimate"]).config(["$routeProvider",function(t){t.when("/publish",{templateUrl:"tpl/publish.html",controller:"publishCtrl"})}]).controller("publishCtrl",["$scope","$http","$timeout",function(t,e,o){t.warn=!1,t.submit=function(){return void 0==localStorage.getItem("accesstoken")?void alert("请登录"):void 0==t.title||void 0==t.pubSel||void 0==t.markdown?void(t.warn=!0):(t.warn=!1,void e.post("https://cnodejs.org/api/v1/topics",{accesstoken:localStorage.getItem("accesstoken"),title:t.title,tab:t.pubSel,content:t.markdown}).then(function(t){alert("发表成功")},function(t){alert("频率限制：当前操作每天可以进行 7 次")}))}}]),window.angular.module("myApp.user",["ngRoute","ngAnimate"]).config(["$routeProvider",function(t){t.when("/user",{templateUrl:"tpl/user.html",controller:"userCtrl"})}]).controller("userCtrl",["$scope","$http","$timeout",function(t,e,o){t.collTopicList=[],t.getUser=function(){e.get("https://cnodejs.org/api/v1/user/"+localStorage.getItem("loginname")).then(function(e){t.loginname=e.data.data.loginname,t.userImg=e.data.data.avatar_url},function(t){console.log(t)})},t.collect=function(){e.get("https://cnodejs.org/api/v1/topic_collect/"+localStorage.getItem("loginname")).then(function(e){t.userTopiccal=e.data.data.length,t.collTopicList=t.collTopicList.concat(e.data.data)},function(t){console.log(t)})},localStorage?localStorage.userInfo?("true"==localStorage.getItem("userInfo")?t.userInfo=!0:t.userInfo=!1,t.getUser(),t.collect()):t.userInfo=!1:console.log("不支持localStorage"),1==t.userInfo?t.regBtn="退出":t.regBtn="登录",t.reg=function(){if("登录"==t.regBtn){if(void 0==t.accesstoken)return void(t.accWarn=!0);t.accWarn=!1,localStorage.setItem("accesstoken",t.accesstoken),e.post("https://cnodejs.org/api/v1/accesstoken",{accesstoken:t.accesstoken}).then(function(e){alert("登录成功"),t.userInfo=!0,localStorage.setItem("userInfo",t.userInfo),t.loginname=e.data.loginname,localStorage.setItem("loginname",t.loginname),t.userImg=e.data.avatar_url,t.regBtn="退出",t.collect(),console.log(e)},function(t){console.log(t),alert("登录失败!! 原因:没有输入accesstoken,或者accesstoken不正确")})}else t.collTopicList.length=0,localStorage.removeItem("accesstoken"),t.userInfo=!1,localStorage.setItem("userInfo",t.userInfo),t.regBtn="登录"}}]);
//# sourceMappingURL=app.min.js.map

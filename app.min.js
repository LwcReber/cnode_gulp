"use strict";!function(t){var o=document.documentElement,e=o.clientWidth;e=e>640?640:e<320?320:e;var n=e/t*100;o.style.fontSize=n+"px"}(414),window.angular.module("myApp",["ngRoute","ngAnimate","infinite-scroll","myApp.start","myApp.msg","myApp.detail","myApp.filtes","dir.footer","dir.header","dir.goback","myApp.publish","myApp.user"]).controller("parentCtrl",["$scope","$location",function(t,o){t.showTDetail=function(t){o.path("/detail").search({topicID:t})}}]).config(["$routeProvider",function(t){t.otherwise("/home")}]).run(["$http",function(t){t.defaults.headers.post={"Content-Type":"application/json; charset=utf-8"}}]),window.angular.module("myApp.detail",["ngRoute","ngAnimate"]).config(["$routeProvider",function(t){t.when("/detail",{templateUrl:"tpl/detail.html",controller:"detailCtrl"})}]).controller("detailCtrl",["$scope","$http","$location",function(t,o,e){t.html="",localStorage.accesstoken?(t.collStu={content:""},t.regStatus=!0,t.acctknUrl="&accesstoken="+localStorage.getItem("accesstoken")):(t.regStatus=!1,t.acctknUrl="");var n=e.search().topicID;n?o.get("https://cnodejs.org/api/v1/topic/"+n+"?mdrender=true"+t.acctknUrl).then(function(o){t.regStatus&&(t.collStu.status=o.data.data.is_collect,console.log(t.collStu.status),1==t.collStu.status?t.collStu.content="取消收藏":t.collStu.content="收藏"),t.html=o.data.data.content},function(t){console.log(t)}):window.history.go(-1),t.coll=function(){0==t.collStu.status?o.post("https://cnodejs.org/api/v1/topic_collect/collect",{accesstoken:localStorage.getItem("accesstoken"),topic_id:n}).then(function(o){t.collStu.status=!0,t.collStu.content="取消收藏"},function(t){console.log(t)}):o.post("https://cnodejs.org/api/v1/topic_collect/de_collect",{accesstoken:localStorage.getItem("accesstoken"),topic_id:n}).then(function(o){t.collStu.status=!1,t.collStu.content="收藏"},function(t){console.log(t)})}}]),window.angular.module("myApp.filtes",["ngRoute","ngAnimate"]).filter("to_trusted",["$sce",function(t){return function(o){return t.trustAsHtml(o)}}]),window.angular.module("dir.footer",["ngRoute","ngAnimate"]).directive("ngFooter",["$location",function(t){return{restrict:"AE",replace:!0,scope:{},templateUrl:"./tpl/footer.html",controller:["$scope",function(o){o.path=t.path(),o.navs=[{tab:"home",path:"/home"},{tab:"msg",path:"/msg"},{tab:"publish",path:"/publish"},{tab:"user",path:"/user"}],o.changeTab=function(o){t.path(o.path)}}]}}]),window.angular.module("dir.goback",["ngRoute","ngAnimate"]).directive("ngGoBack",[function(){return{restrict:"AE",scope:{},replace:!0,template:'<div class="go-back" ng-click="goBack()">返回</div>',controller:["$scope","$element","$attrs","$transclude",function(t,o,e,n){t.goBack=function(){window.history.go(-1)}}]}}]),window.angular.module("dir.header",["ngRoute","ngAnimate"]).directive("ngHeader",["$location",function(t){return{restrict:"E",scope:{},replace:!0,templateUrl:"./tpl/header.html",controller:["$scope",function(o){o.title="header",o.path=t.path()}]}}]),window.angular.module("myApp.start",["ngRoute","ngAnimate"]).config(["$routeProvider",function(t){t.when("/home",{templateUrl:"tpl/home.html",controller:"homeCtrl"})}]).controller("homeCtrl",["$scope","$http","$timeout","$location",function(t,o,e,n){t.hasMore=!0,t.topicList=[],t.scroll=!1,t.page=1,t.scrollTab="",t.tabs=[{tab:"",name:"全部",active:!0},{tab:"good",name:"精华",active:!1},{tab:"share",name:"分享",active:!1},{tab:"ask",name:"问答",active:!1},{tab:"job",name:"招聘",active:!1}],t.getDatas=function(e){t.scroll=!0,t.tabtypeShow=""==e||"good"==e,o.get("https://cnodejs.org/api/v1/topics?page="+t.page+"&tab="+e+"&limit=20",{timeout:3e3}).then(function(o){-1!=Object.prototype.toString.call(o).indexOf("Object")?(o.data.data.lenth<20?t.hasMore=!1:t.scroll=!1,t.topicList=t.topicList.concat(o.data.data),t.page++):console.log("后台发送的topicList数据类型错误")},function(t){})},t.changeTopic=function(o){for(var e=0;e<t.tabs.length;e++)t.tabs[e]!=o&&(t.tabs[e].active=!1);t.scrollTab=o.tab,t.page=1,o.active=!0,t.topicList.length=0,t.getDatas(o.tab)},window.onscroll=function(){var o=(window.pageXOffset,window.pageYOffset);console.log(o),o>800?t.$apply(function(){t.toTop=!0}):t.$apply(function(){t.toTop=!1}),console.log(t.toTop)}}]),window.angular.module("myApp.msg",["ngRoute","ngAnimate"]).config(["$routeProvider",function(t){t.when("/msg",{templateUrl:"tpl/msg.html",controller:"msgCtrl"})}]).controller("msgCtrl",["$scope","$http","$timeout",function(t,o,e){t.oldMsg="无消息",t.newMsg="无消息",t.msg=!1,void 0!=localStorage.getItem("accesstoken")&&o.get("https://cnodejs.org/api/v1/messages?&accesstoken="+localStorage.getItem("accesstoken")+"&mdrender=true").then(function(o){0==o.data.data.hasnot_read_messages.length?t.msg=!1:(t.msg=!0,t.newMsg=o.data.data.hasnot_read_messages),0==o.data.data.has_read_messages.length&&(t.oldMsg="无消息")},function(t){console.log(t)})}]),window.angular.module("myApp.publish",["ngRoute","ngAnimate"]).config(["$routeProvider",function(t){t.when("/publish",{templateUrl:"tpl/publish.html",controller:"publishCtrl"})}]).controller("publishCtrl",["$scope","$http","$timeout",function(t,o,e){t.warn=!1,t.submit=function(){return void 0==localStorage.getItem("accesstoken")?void alert("请登录"):void 0==t.title||void 0==t.pubSel||void 0==t.markdown?void(t.warn=!0):(t.warn=!1,void o.post("https://cnodejs.org/api/v1/topics",{accesstoken:localStorage.getItem("accesstoken"),title:t.title,tab:t.pubSel,content:t.markdown}).then(function(t){alert("发表成功")},function(t){alert("频率限制：当前操作每天可以进行 7 次")}))}}]),window.angular.module("myApp.user",["ngRoute","ngAnimate"]).config(["$routeProvider",function(t){t.when("/user",{templateUrl:"tpl/user.html",controller:"userCtrl"})}]).controller("userCtrl",["$scope","$http","$timeout",function(t,o,e){t.collTopicList=[],t.getUser=function(){o.get("https://cnodejs.org/api/v1/user/"+localStorage.getItem("loginname")).then(function(o){t.loginname=o.data.data.loginname,t.userImg=o.data.data.avatar_url},function(t){console.log(t)})},t.collect=function(){o.get("https://cnodejs.org/api/v1/topic_collect/"+localStorage.getItem("loginname")).then(function(o){t.userTopiccal=o.data.data.length,t.collTopicList=t.collTopicList.concat(o.data.data)},function(t){console.log(t)})},localStorage?localStorage.userInfo?("true"==localStorage.getItem("userInfo")?t.userInfo=!0:t.userInfo=!1,t.getUser(),t.collect()):t.userInfo=!1:console.log("不支持localStorage"),t.reg=function(){if(console.log(t.regBtn),0==t.userInfo){if(void 0==t.accesstoken)return void(t.accWarn=!0);t.accWarn=!1,localStorage.setItem("accesstoken",t.accesstoken),o.post("https://cnodejs.org/api/v1/accesstoken",{accesstoken:t.accesstoken}).then(function(o){alert("登录成功"),t.collTopicList=[],t.userInfo=!0,localStorage.setItem("userInfo",t.userInfo),t.loginname=o.data.loginname,localStorage.setItem("loginname",t.loginname),t.userImg=o.data.avatar_url,t.collect(),console.log(o)},function(t){console.log(t),alert("登录失败!! 可能原因:accesstoken不正确")})}else t.accesstoken="",localStorage.removeItem("accesstoken"),t.userInfo=!1,localStorage.setItem("userInfo",t.userInfo)}}]);
//# sourceMappingURL=app.min.js.map

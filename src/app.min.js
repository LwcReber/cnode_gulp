'use strict';

angular.module('myApp', [
  'ngRoute',
  'ngAnimate',
  'myApp.start',
  'myApp.main'
  // 'myApp.detail',
  // 'myApp.order',
  // 'myApp.orderList'
])
  .controller('parent', ['$scope', function($scope){
    $scope.headerFile = 'tpl/header.html';
    $scope.footerFile = 'tpl/footer.html';
  }])
  .config(['$routeProvider', function($routeProvider) {
    $routeProvider.otherwise('/start');
  }])
  .run(function($http){
    $http.defaults.headers.post = {'Content-Type' : 'application/x-www-form-urlencoded'};
  })

'use strict';
angular.module('myApp.main', ['ngRoute','ngAnimate'])
  .config(['$routeProvider', function($routeProvider) {
    $routeProvider
      .when('/main', {
      templateUrl: 'tpl/main.html',
      controller: 'mainCtrl'
    });
  }])

  .controller('mainCtrl', ['$scope', '$http', function($scope,$http) {
    var firstList= null;
    $http.get('data/dish_getbypage.php')
      .success(function(data){
        $scope.dishList = data;
        firstList = data;
      });
    //搜索功能
    $scope.$watch('kw',function() {
      if ($scope.kw) {
        $http.get("data/dish_getbykw.php?kw=" + $scope.kw)
          .success(function (data) {
            $scope.dishList = data;
          });
      }else{
        $scope.dishList =firstList;
      }
    });
    $scope.hasMore=true;
    //加载更多监听函数
    $scope.loadMore=function(){
      $http.get("data/dish_getbypage.php?start="+$scope.dishList.length)
        .success(function(data){
          data.length<=5&&($scope.hasMore=false);
          $scope.dishList =$scope.dishList.concat(data);
        });
    }
  }])

'use strict';

angular.module('myApp.start', ['ngRoute','ngAnimate'])

.config(['$routeProvider', function($routeProvider) {
  $routeProvider.when('/start', {
    templateUrl: 'tpl/start.html',
    controller: 'startCtrl'
  })
  
}])

.controller('startCtrl', ['$location','$timeout',function($location,$timeout) {

  $timeout(function(){
    console.log($location);
    $location.path('/main');
  },3000);
}])

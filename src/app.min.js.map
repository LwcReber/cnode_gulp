{"version":3,"sources":["app.js","detail.js","filters.js","footer.js","goback.js","header.js","home.js","message.js","publish.js","user.js"],"names":["baseWidth","root","document","documentElement","w","clientWidth","fz","style","fontSize","window","angular","module","controller","$scope","$location","showTDetail","id","path","search","topicID","config","$routeProvider","otherwise","run","$http","defaults","headers","post","Content-Type","when","templateUrl","html","localStorage","accesstoken","collStu","content","regStatus","acctknUrl","getItem","get","then","res","status","data","is_collect","console","log","err","history","go","coll","topic_id","result","filter","$sce","text","trustAsHtml","directive","restrict","replace","scope","navs","tab","changeTab","nav","template","$element","$attrs","$transclude","goBack","title","$timeout","scroll","hasMore","topicList","getDatas","timeout","Object","prototype","toString","call","indexOf","lenth","concat","tabs","name","active","changeTopic","i","length","oldMsg","newMsg","msg","undefined","hasnot_read_messages","has_read_messages","warn","submit","alert","pubSel","markdown","collTopicList","getUser","loginname","userImg","avatar_url","collect","userTopiccal","userInfo","regBtn","reg","accWarn","setItem","removeItem"],"mappings":"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","file":"app.min.js","sourcesContent":["'use strict';\r\n\r\n(function rem(baseWidth){\r\n    var root = document.documentElement;\r\n    var w = root.clientWidth;\r\n    w = w > 640 ? 640 : w < 320 ? 320 : w;\r\n    var fz = w / baseWidth * 100;\r\n    root.style.fontSize = fz + \"px\";\r\n}(414))\r\n\r\n// 加 window 避免 eslint 报错\r\nwindow.angular.module('myApp', [\r\n    'ngRoute',\r\n    'ngAnimate',\r\n    'infinite-scroll',\r\n    'myApp.start',\r\n    'myApp.msg',\r\n    'myApp.detail',\r\n    'myApp.filtes', // 所有的指令模块\r\n    'dir.footer',\r\n    'dir.header',\r\n    'dir.goback',\r\n    'myApp.publish',\r\n    'myApp.user'\r\n    // 'myApp.detail',\r\n    // 'myApp.order',\r\n    // 'myApp.orderList'\r\n  ])\r\n  .controller('parentCtrl',['$scope','$location',function($scope,$location){\r\n    // 查看topic 详情\r\n    $scope.showTDetail = function(id) {\r\n      // 转跳到详情页\r\n      $location.path('/detail').search({topicID: id});\r\n    }\r\n  }])\r\n  .config(['$routeProvider', function($routeProvider) {\r\n    $routeProvider.otherwise('/home');\r\n  }])\r\n\r\n  .run(['$http', function($http){\r\n    $http.defaults.headers.post = {'Content-Type' : 'application/json; charset=utf-8'};\r\n\r\n  }])\r\n","'use strict';\r\n\r\nwindow.angular.module('myApp.detail', ['ngRoute','ngAnimate'])\r\n  .config(['$routeProvider', function($routeProvider) {\r\n    $routeProvider\r\n      .when('/detail', {\r\n      templateUrl: 'tpl/detail.html',\r\n      controller: 'detailCtrl'\r\n    });\r\n  }])\r\n\r\n  .controller('detailCtrl', ['$scope', '$http', '$location', function($scope, $http, $location) {\r\n    $scope.html = '';\r\n    //如果已经登录\r\n    if(localStorage.accesstoken){\r\n      $scope.collStu={\r\n        content:''\r\n      };\r\n      $scope.regStatus=true;//收藏按钮显示\r\n      $scope.acctknUrl='&accesstoken=' + localStorage.getItem('accesstoken');\r\n      //如果没有登录收藏功能隐藏\r\n    }else {\r\n      $scope.regStatus=false;//收藏按钮隐藏\r\n      $scope.acctknUrl='';\r\n    }\r\n\r\n    // 获取 topic id 编号\r\n    var topicID = $location.search().topicID;\r\n    // 如果 有路由参数传过来，就请求数据，容错处理 if else\r\n    if (topicID) {\r\n      $http.get('https://cnodejs.org/api/v1/topic/' + topicID + '?mdrender=true'+$scope.acctknUrl)\r\n        .then(function(res) {\r\n          //是否已经登录\r\n          if($scope.regStatus){\r\n            //判断主题是否被收藏\r\n            $scope.collStu.status= res.data.data.is_collect;\r\n            console.log($scope.collStu.status);\r\n            //如果被收藏就显示取消收藏  true: 主题已经被收藏   false:主题没有收藏\r\n            if($scope.collStu.status==true){\r\n              $scope.collStu.content = '取消收藏'\r\n            }else {\r\n              $scope.collStu.content = '收藏'\r\n            }\r\n          }\r\n          //载入topic的内容\r\n          $scope.html = res.data.data.content;\r\n        }, function(err) {\r\n          console.log(err);\r\n        });\r\n\r\n    } else {\r\n      // 如果没有id ，就返回前一页\r\n      // 使用 浏览器 默认 返回  history.go(-1) , -1:表示后退一步\r\n      window.history.go(-1);\r\n    }\r\n    //收藏按钮的状态\r\n    //需要获取用户所收藏的主体与之进行判断。然后显示主体是否被收藏\r\n    $scope.coll = function(){\r\n      //收藏主题\r\n      if($scope.collStu.status==false){\r\n        $http.post('https://cnodejs.org/api/v1/topic_collect/collect',\r\n          {\r\n            accesstoken:localStorage.getItem('accesstoken'),\r\n            topic_id:topicID\r\n          }\r\n        )\r\n        .then(function(result){\r\n          //收藏成功 ，改变按钮显示\r\n            $scope.collStu.status = true;\r\n            $scope.collStu.content = '取消收藏'\r\n        },function(err){\r\n          console.log(err);\r\n        })\r\n      }else {//取消收藏\r\n        $http.post('https://cnodejs.org/api/v1/topic_collect/de_collect',\r\n          {\r\n            accesstoken:localStorage.getItem('accesstoken'),\r\n            topic_id:topicID\r\n          }\r\n        )\r\n        .then(function(result){\r\n          //console.log(result);\r\n            $scope.collStu.status = false;\r\n            $scope.collStu.content='收藏'\r\n        },function(err){\r\n          console.log(err);\r\n        })\r\n     }\r\n    }\r\n  }])\r\n","'use strict';\r\n\r\nwindow.angular.module('myApp.filtes', ['ngRoute','ngAnimate'])\r\n.filter('to_trusted', ['$sce', function ($sce) {\r\n  return function (text) {\r\n    return $sce.trustAsHtml(text);\r\n  };\r\n}]);\r\n","'use strict';\r\n\r\nwindow.angular.module('dir.footer', ['ngRoute', 'ngAnimate'])\r\n  .directive('ngFooter', ['$location', function($location) {\r\n    return {\r\n      restrict: 'AE',\r\n      replace: true,\r\n      scope: {},\r\n      templateUrl: './tpl/footer.html',\r\n      controller: ['$scope', function($scope) {\r\n        // 用于判断当前处于哪个 tab页，给对应的tab 导航键 加激活样式\r\n        $scope.path = $location.path();\r\n        // 导航\r\n        $scope.navs = [\r\n          { tab: 'home', path: '/home' },\r\n          { tab: 'msg', path: '/msg' },\r\n          { tab: 'publish', path: '/publish' },\r\n          { tab: 'user', path: '/user' }\r\n        ];\r\n        // 切换导航时，更换路由\r\n        $scope.changeTab = function (nav) {\r\n          $location.path(nav.path);\r\n        }\r\n\r\n      }]\r\n      // link: function ($scope, elm, attr, controller) {\r\n      //\r\n      // }\r\n    }\r\n  }])\r\n","'use strict';\r\n\r\nwindow.angular.module('dir.goback', ['ngRoute','ngAnimate'])\r\n  .directive('ngGoBack', [function() {\r\n    return {\r\n      restrict: 'AE',\r\n      scope: {},\r\n      replace: true,\r\n      template: '<div class=\"go-back\" ng-click=\"goBack()\">返回</div>',\r\n      // link: function ($scope, elm, attr, controller) {\r\n      // },\r\n      controller: ['$scope', '$element', '$attrs', '$transclude', function($scope, $element, $attrs, $transclude) {\r\n        $scope.goBack = function() {\r\n          window.history.go(-1);\r\n        }\r\n      }],\r\n    }\r\n  }])\r\n","'use strict';\r\n\r\nwindow.angular.module('dir.header', ['ngRoute','ngAnimate'])\r\n  .directive('ngHeader', ['$location',function($location) {\r\n    return {\r\n      restrict: 'E',\r\n      scope: {},\r\n      replace: true,\r\n      templateUrl: './tpl/header.html',\r\n      // link: function ($scope, elm, attr, controller) {\r\n      // }, , $element, $attrs, $transclude\r\n      controller: ['$scope', function($scope) {\r\n        $scope.title = 'header';\r\n        $scope.path = $location.path();\r\n        // 导航\r\n        // 切换导航时，更换路由\r\n      \r\n      }],\r\n    }\r\n  }])\r\n","'use strict';\r\n\r\n// 加 window 避免 eslint 报错\r\nwindow.angular.module('myApp.start', ['ngRoute','ngAnimate'])\r\n\r\n.config(['$routeProvider', function($routeProvider) {\r\n  $routeProvider.when('/home', {\r\n    templateUrl: 'tpl/home.html',\r\n    controller: 'homeCtrl'\r\n  });\r\n}])\r\n\r\n.controller('homeCtrl', ['$scope', '$http', '$timeout', '$location', function($scope, $http, $timeout, $location) {\r\n  $scope.scroll=false;\r\n  $scope.hasMore=true;\r\n  // topicList data\r\n  $scope.topicList = [];\r\n\r\n  // 封装一个 获取后台数据的方法\r\n  $scope.getDatas= function(tab) { // tab用于切换不同tab时，\r\n    $scope.scroll=true;//禁止滚动执行事件\r\n    $http.get('https://cnodejs.org/api/v1/topics?page=1&tab=' + tab + '&limit=20', {\"timeout\": 3000})\r\n    .then(function(result) {\r\n      if(Object.prototype.toString.call(result).indexOf('Object')!=-1){\r\n        //没有更多内容\r\n        if(result.data.data.lenth<20){\r\n          $scope.hasMore=false;\r\n        }else {\r\n          $scope.scroll=false;\r\n        }\r\n        $scope.topicList = $scope.topicList.concat(result.data.data);\r\n      }else {\r\n        console.log('后台发送的topicList数据类型错误')\r\n      }\r\n    }, function(err){\r\n      /* eslint-disable no-console */\r\n      //console.log(err);\r\n      /* eslint-enable no-console */\r\n    });\r\n  }\r\n\r\n  // 初次请求 （此方法 并不太推荐使用，$timeout 跟settimeout一样，会等其他程序都跑完才会执行，可能会出现空白）\r\n  // $timeout(function () {\r\n  //   $scope.getDatas('');\r\n  // }, 0);\r\n\r\n  // 主题导航\r\n  $scope.tabs = [\r\n    { tab: '', name: '全部', active: true },\r\n    { tab: 'good', name: '精华', active: false },\r\n    { tab: 'share', name: '分享', active: false },\r\n    { tab: 'ask', name: '问答', active: false },\r\n    { tab: 'job', name: '招聘', active: false },\r\n  ];\r\n  // 切换导航方法\r\n  $scope.changeTopic = function(tab) {\r\n    //清除其他tab的active\r\n    for(var i=0 ; i<$scope.tabs.length ;i++){\r\n      if($scope.tabs[i]!=tab){\r\n        $scope.tabs[i].active=false;\r\n      }\r\n    }\r\n    tab.active=true;\r\n    //清空原有的数据\r\n    $scope.topicList = [];\r\n    //请求对应的tab数据\r\n    $scope.getDatas(tab.tab);\r\n  }\r\n\r\n}])\r\n","'use strict';\r\n\r\nwindow.angular.module('myApp.msg', ['ngRoute','ngAnimate'])\r\n  .config(['$routeProvider', function($routeProvider) {\r\n    $routeProvider\r\n      .when('/msg', {\r\n      templateUrl: 'tpl/msg.html',\r\n      controller: 'msgCtrl'\r\n    });\r\n  }])\r\n\r\n  .controller('msgCtrl', ['$scope', '$http', '$timeout', function($scope, $http, $timeout) {\r\n\r\n    $scope.oldMsg='无消息'\r\n    $scope.newMsg='无消息'\r\n    $scope.msg=false;\r\n\r\n    if(localStorage.getItem('accesstoken')==undefined){\r\n      return;\r\n    }\r\n    $http.get('https://cnodejs.org/api/v1/messages?&'+'accesstoken='+localStorage.getItem('accesstoken')+'&mdrender=true')\r\n    .then(function(result){\r\n      //新消息\r\n      if(result.data.data.hasnot_read_messages.length==0){\r\n       $scope.msg=false;\r\n      }else {\r\n        $scope.msg=true;\r\n        $scope.newMsg=result.data.data.hasnot_read_messages;\r\n     }\r\n     //过往消息\r\n      if(result.data.data.has_read_messages.length==0){\r\n        $scope.oldMsg='无消息'\r\n      }\r\n    } , function(err){\r\n      console.log(err);\r\n    }\r\n  )\r\n  }])\r\n","'use strict';\r\n\r\nwindow.angular.module('myApp.publish', ['ngRoute', 'ngAnimate'])\r\n  .config(['$routeProvider' , function($routeProvider){\r\n    $routeProvider\r\n    .when('/publish', {\r\n      templateUrl: 'tpl/publish.html',\r\n      controller: 'publishCtrl'\r\n    });\r\n  }])\r\n\r\n  .controller('publishCtrl' , ['$scope' , '$http' , '$timeout',function($scope,$http,$timeout){\r\n    $scope.warn = false;\r\n    $scope.submit=function(){\r\n      //没有登录不能发表主题\r\n      if(localStorage.getItem('accesstoken')==undefined){\r\n        alert('请登录')\r\n        return;\r\n      }\r\n      //内容为空不发送请求\r\n      if($scope.title==undefined||$scope.pubSel==undefined||$scope.markdown==undefined){\r\n        $scope.warn = true;\r\n        return;\r\n      }\r\n      $scope.warn = false;\r\n      $http.post('https://cnodejs.org/api/v1/topics',\r\n      {\r\n        accesstoken:localStorage.getItem('accesstoken'),\r\n        title:$scope.title,\r\n        tab:$scope.pubSel,\r\n        content:$scope.markdown\r\n      })\r\n      .then(function(result){\r\n        alert('发表成功')\r\n      },function(err){\r\n        alert('频率限制：当前操作每天可以进行 7 次')\r\n      })\r\n    }\r\n  }])\r\n","'use strict';\r\n\r\nwindow.angular.module('myApp.user', ['ngRoute', 'ngAnimate'])\r\n  .config(['$routeProvider' , function($routeProvider){\r\n    $routeProvider\r\n    .when('/user', {\r\n      templateUrl: 'tpl/user.html',\r\n      controller: 'userCtrl'\r\n    });\r\n  }])\r\n\r\n  .controller('userCtrl' , ['$scope' , '$http' , '$timeout',function($scope,$http,$timeout){\r\n    $scope.collTopicList=[];\r\n    //用户详情\r\n    $scope.getUser=function(){\r\n      $http.get('https://cnodejs.org/api/v1/user/'+localStorage.getItem('loginname'))\r\n      .then(function(result){\r\n        $scope.loginname = result.data.data.loginname;\r\n        $scope.userImg = result.data.data.avatar_url;\r\n      }, function(err){\r\n          console.log(err);\r\n      })\r\n    }\r\n    //获取用户收藏的主题\r\n    $scope.collect=function(){\r\n      $http.get('https://cnodejs.org/api/v1/topic_collect/'+localStorage.getItem('loginname'))\r\n      .then(function(result){\r\n        $scope.userTopiccal = result.data.data.length;\r\n        $scope.collTopicList =$scope.collTopicList.concat(result.data.data);\r\n      },function(err){\r\n        console.log(err);\r\n      })\r\n    }\r\n\r\n    //判断是否支持localStorage\r\n    if (localStorage) {\r\n      //判断localStorage 是否有userInfo属性\r\n      if(localStorage.userInfo){\r\n        //如果已经登录  显示userInfo\r\n        localStorage.getItem('userInfo') =='true'? ($scope.userInfo = true) :($scope.userInfo = false)\r\n        //获取用户详情\r\n        $scope.getUser();\r\n        //获取收藏话题\r\n        $scope.collect();\r\n      }else {\r\n        //没有userInfo属性 不显示用户内容\r\n        $scope.userInfo =false;\r\n      }\r\n    } else {\r\n        console.log('不支持localStorage');\r\n    }\r\n\r\n    //改变登录按钮显示的文字\r\n    if($scope.userInfo ==true){\r\n      $scope.regBtn = '退出'\r\n    }else {\r\n      $scope.regBtn = '登录'\r\n    }\r\n\r\n    $scope.reg=function(){\r\n      //登录\r\n      if($scope.regBtn=='登录'){\r\n        //如果没有输入accesstoken\r\n        if($scope.accesstoken==undefined){\r\n          $scope.accWarn=true;\r\n          return;\r\n        }\r\n        $scope.accWarn=false;\r\n        localStorage.setItem('accesstoken', $scope.accesstoken)\r\n        $http.post('https://cnodejs.org/api/v1/accesstoken',{accesstoken:$scope.accesstoken})\r\n        .then(function(result){\r\n          alert('登录成功');\r\n          $scope.userInfo=true;\r\n          //本地保存登录状态\r\n          localStorage.setItem('userInfo' , $scope.userInfo);\r\n          $scope.loginname = result.data.loginname\r\n          //保存用户名，用点击user ，请求获取用户的详情\r\n          localStorage.setItem('loginname' ,$scope.loginname)\r\n          //替换头像\r\n          $scope.userImg = result.data.avatar_url;\r\n          $scope.regBtn = '退出'\r\n          //刷新收藏话题\r\n          $scope.collect();\r\n          console.log(result);\r\n        },function(err){\r\n          console.log(err);\r\n          alert('登录失败!! 原因:没有输入accesstoken,或者accesstoken不正确')\r\n        })\r\n\r\n      }else {//退出登录\r\n        //清除原有的内容\r\n        $scope.collTopicList.length=0;\r\n        //清除当前的accesstoken\r\n        localStorage.removeItem('accesstoken');\r\n        $scope.userInfo=false;\r\n        //保存退出状态\r\n        localStorage.setItem('userInfo' , $scope.userInfo);\r\n        $scope.regBtn='登录'\r\n      }\r\n    }\r\n\r\n  }])\r\n"]}